#include<stdio.h>
#include<string.h>
const int Max=1000;
typedef struct a{
	char pre[6];
	int data;
	char next[6];
}node;
int main()
{
	int num,i,N,j;
	char a[6],b[]={"-1"};
	node Node[Max],p;
	scanf("%s %d %d",a,&num,&N);
	for(i=0;i<num;i++)
	{
		scanf("%s %d %s",p.pre,&p.data,p.next);
		strcpy(Node[p.data].pre,p.pre);
		Node[p.data].data=p.data;
		strcpy(Node[p.data].next,p.next);

	}
	for(i=1;(i+N-1)<=num;i+=N)
	{
		for(j=i;j<i+N/2;j++)
		{
			strcpy(p.pre,Node[j].pre);
			p.data=Node[j].data;
			strcpy(Node[j].pre,Node[i+N-1-(j-i)].pre);
			Node[j].data=Node[i+N-1-(j-i)].data;
			strcpy(Node[i+N-1-(j-i)].pre,p.pre);
			Node[i+N-1-(j-i)].data=p.data;
		}
	}
	for(j=1;j<=num/N*N;j++)
		strcpy(Node[j].next,Node[j+1].pre);
	strcpy(Node[num].next,b);
	for(j=1;j<=num;j++)
		printf("%s %d %s\n",Node[j].pre,Node[j].data,Node[j].next);
	return 0;
}